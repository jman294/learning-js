<!DOCTYPE html>
<html>
<head>
  <title>YEA</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script
          src="https://code.jquery.com/jquery-3.1.1.min.js"
          integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
          crossorigin="anonymous"></script>
</head>
<body>
  <div class="app">
    <div id="message">
      <div id="type-input" tabindex="1" contenteditable="true"></div>
      <p id="error"></p>
    </div>
  </div>
  <script type="text/javascript">
    // Element for where user typing errors go
    var error = $('#error')
    var type_input = $('#type-input')

    var text = 'The year of our Potterhead 2016 might just be the most magical year to date, thanks to the release of the script version of Harry Potter and the Cursed Child on July 31 and the anticipated release of the movie Fantastic Beasts and Where to Find Themon November 18. Now that J.K. Rowling has kept the party going with her release of new Harry Potter short stories on Pottermore, you are probably desperate to '

    $(type_input).text(text)
    $(type_input).focus()
    var index = 0;

    $(type_input).on('keypress', function onKeyPressed (e) {
      e.preventDefault()
      checkType(e).then(function correctKey () {
        // Increase position in text by one if correct key typed
        console.log('correct')
        index++
      }, function wrongKey (keyValue) {
        if (keyValue == 8) {
          // If the user presses the backspace key
          removeErrorLetter()
        } else {
          // If the user typed an incorrect key, append that to error
          console.log('incorrect')
          $(error).append(String.fromCharCode(keyValue))
        }
      })
    }).on('keyup', function onKeyUp (e) {
      console.log('keyup')
      if (e.which == 8) {
        removeErrorLetter()
        e.preventDefault()
      }
    })
    function checkType (e) {
      return new Promise (function(resolve, reject) {
        var keyValue = e.keyCode || e.which
        console.log(keyValue)

        if (String.fromCharCode(keyValue) == text.charAt(index) && error.text().length <= 0) {
          resolve()
        } else {
          reject(keyValue)
        }
      })
    }
    // Make #type-input readonly with event stopping
    function removeErrorLetter () {
      console.log('backspace')
      if ($(error).text().length > 0) {
        // Remove last letter from error only if error is not empty
        $(error).text(function (_,txt) {
          return txt.slice(0, -1);
        });
      }
    }
  </script>
</body>
</html>